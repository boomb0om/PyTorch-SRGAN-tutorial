# A PyTorch SRGAN tutorial (Russian)

Этот репозиторий является руководством по обучению и использованию модели SRGAN (Super Resolution GAN). 

*Предполагается, что у читателя имеются базовые знания о нейросетях!*


## О задаче SISR и SRGAN

**SISR** (Single Image Super Resolution) - задача увеличения разрешения (качества) *одного* изображения. Если поставить задачу более корректно, то необходимо реконструировать изображение с высоким разрешением (Super Resolution, SR) из входного изображения с низким разрешением (Low Resolution, LR), которое является уменьшенной копией изначального снимка (High Resolution, HR).

Одни из самых известных методов увеличения разрешения изображения - это [билинейная интерполяция](https://ru.wikipedia.org/wiki/%D0%91%D0%B8%D0%BB%D0%B8%D0%BD%D0%B5%D0%B9%D0%BD%D0%B0%D1%8F_%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%BF%D0%BE%D0%BB%D1%8F%D1%86%D0%B8%D1%8F) и [бикубическая интерполяция](https://ru.wikipedia.org/wiki/%D0%91%D0%B8%D0%BA%D1%83%D0%B1%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F_%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%BF%D0%BE%D0%BB%D1%8F%D1%86%D0%B8%D1%8F). Эти методы работают быстро, но выдают решения с чрезмерно гладкими текстурами. Более мощные подходы основаны на использовании нейросетей, которых обучают генерировать изображения высокого качества из изображений с низким качеством. 

Для многих подходов, использующих нейронные сети, применяются *попиксельные (pixel-wise)* функции потерь (например, *MSE* или *MAE*). Минимизация такой ошибки приводит к тому, что модель находит средние вероятностные решения для каждого пикселя, поэтому они получаются слишком гладкими и, следовательно, имеют низкое качество восприятия, как показано на рисунке ниже. <br>
![Различные методы SISR](images/SISR_methods_compare.png)



**SRGAN**

[Оригинальная статья](https://arxiv.org/pdf/1609.04802.pdf)

SRGAN (Super Resolution GAN) - подход к решению задачи SISR, основанный на GAN (генеративно-состязательных сетях).

[Генеративно-состязательные сети](https://ru.wikipedia.org/wiki/%D0%93%D0%B5%D0%BD%D0%B5%D1%80%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D0%BE-%D1%81%D0%BE%D1%81%D1%82%D1%8F%D0%B7%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%81%D0%B5%D1%82%D1%8C) - это алгоритм, построенный на комбинации из двух нейронных сетей, одна из которых (генератор) генерирует образцы, а другая (дискриминатор) старается отличить правильные («подлинные») образцы от неправильных.

Успех SRGAN в задаче SISR обусловлен двумя важными особенностями:

- Генеративно-состязательные сети позволяют создавать более реалистичные изображения, чем нейросети, основанные на оптимизации MSE между пикселями. Модели, ориентированные на оптимизацию MSE по пикселям, "усредняли" текстуры, что делало их чрезмерно гладкими.  Использование GAN-ов, благодаря дискриминатору, который учится отличать фейковые сгенерированные изображения от настоящих, позволяет генерировать изображение из множества реалистичных вариантов, не усредняя все текстуры. <br> ![Alt Распределение возможных фотореалистичных изображений](images/natural_manifold.png)
- Второй важной особенностью стало использование **perceptual loss**, которая основывается на евклидовых расстояниях (MSE, MAE), вычисленных в пространстве признаков глубокой сверточной нейронной сети (например, предварительно обученной VGG). Такая функция ошибки будет более инвариантна к изменениям пикселям на изображении, чем попиксельные MSE или MAE.



**Архитектура сети**

В основе генеративной сети находятся B residual блоков с одинаковой структурой. В каждом блоке находятся два свёрточных слоя с ядрами 3x3 и 64 каналами, за которыми расположены слои [batch-norm](https://habr.com/ru/post/309302/). В качестве функции активации используется [PReLU (Parametric Rectified Linear Unit)](https://congyuzhou.medium.com/prelu-e0bc339d9c01). Входное изображение увеличивается попиксельно с помощью двух свёрточных слоев с операцией [PixelShuffle](https://paperswithcode.com/method/pixelshuffle) и функцией активации PReLU.

В качестве дискриминатора используется типичная для классификатора изображений архитектура глубокой сверточной сети с fully-connected слоями в конце.

Архитектуры генератора и дискриминатора на рисунке:
![SRGAN structure](images/srgan_architecture.png)